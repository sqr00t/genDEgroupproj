## Run these in the same folder! Change buckets and pathings as appropriate ##

Powershell:
docker run --rm -v ${PWD}:/var/task "lambci/lambda:build-python3.8" /bin/sh -c "pip install -r requirements.txt -t build/packages; cd build/packages && zip -r ../redshiftconn.zip .; cd ../../; rm -r build/packages; zip -g build/redshiftconn.zip redshiftconn.py; exit"

creating stack:
aws cloudformation create-stack --stack-name sqr00t-testRSconn --template-url https://sqr00t-cf.s3.eu-west-1.amazonaws.com/templates/testRSconn.yaml --region eu-west-1 --parameters ParameterKey=DeploymentBucket,ParameterValue='sqr00t-cf' ParameterKey=DeploymentPackageKey,ParameterValue='lambdas/redshiftconn.zip' ParameterKey=BucketName,ParameterValue='sqr00t-redshiftconn' --capabilities CAPABILITY_IAM



Lambda Layer version 1:
Powershell:
docker run --rm -v ${PWD}:/var/task "lambci/lambda:build-python3.8" /bin/sh -c "pip install -r requirements_lambdalayer.txt -t build/packages; cd build/packages && zip -r ../lambda_layer_v1.zip .; cd ../../; rm -r build/packages; pip install -r requirements_lambdafunction.txt -t build/packages; cd build/packages && zip -r ../lambda_function.zip .; cd ../../; rm -r build/packages; zip -g build/lambda_function.zip ssm_params.py; exit"

copy both zips to bucket:
aws s3 cp build/lambda_function.zip s3://sqr00t-cf/lambdafunctions/; aws s3 cp build/lambda_layer_v1.zip s3://sqr00t-cf/lambdalayers/

copy template to bucket:
aws s3 cp ../templates/testssm_params_lambda_layer.yaml s3://sqr00t-cf/templates/

creating stack:
aws cloudformation create-stack --stack-name sqr00t-test-lambdalayer-ssmparams --template-url https://sqr00t-cf.s3.eu-west-1.amazonaws.com/templates/testssm_params_lambda_layer.yaml --region eu-west-1 --parameters ParameterKey=DeploymentBucket,ParameterValue='sqr00t-cf' ParameterKey=DeploymentPackageKey,ParameterValue='lambdafunctions/lambda_function.zip' ParameterKey=BucketName,ParameterValue='sqr00t-ssmparams' --capabilities CAPABILITY_IAM
